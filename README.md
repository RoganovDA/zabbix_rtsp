# üõ∞Ô∏è check_rtsp.py ‚Äî –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ RTSP-–ø–æ—Ç–æ–∫–æ–≤ —á–µ—Ä–µ–∑ OpenCV / GStreamer / FFprobe

–°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ RTSP-–≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏–ª–∏ –∫–∞–∫ –≤–Ω–µ—à–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –≤ —Å–∏—Å—Ç–µ–º–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ **Zabbix**.

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–∞, –ø–æ–ª—É—á–∞–µ—Ç –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∏–¥–µ–æ–∫–∞–¥—Ä—ã, –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (–¥–≤–∏–∂–µ–Ω–∏–µ), —è—Ä–∫–æ—Å—Ç—å, FPS –∏ –¥—Ä—É–≥–æ–µ.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ç–æ–∫–∞ —á–µ—Ä–µ–∑ **OpenCV** –∏–ª–∏ **GStreamer**
- –†–µ–∑–µ—Ä–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –ø–æ–º–æ—â—å—é **FFprobe**
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö: —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, –∫–æ–¥–µ–∫
- –ü–æ–¥—Å—á—ë—Ç:
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∫–∞–¥—Ä–æ–≤
  - –°—Ä–µ–¥–Ω–µ–≥–æ FPS
  - –°—Ä–µ–¥–Ω–µ–π —è—Ä–∫–æ—Å—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  - –°—Ä–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏ (–¥–µ—Ç–µ–∫—Ç–æ—Ä –¥–≤–∏–∂–µ–Ω–∏—è)
- JSON-–≤—ã–≤–æ–¥ –¥–ª—è Zabbix
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏

---

## üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã:

```bash
sudo apt update
sudo apt install -y python3-opencv ffmpeg
pip3 install numpy
```

> –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `ffprobe` (–∏–∑ —Å–æ—Å—Ç–∞–≤–∞ `ffmpeg`) –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `$PATH`.

### 2. –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤–Ω–µ—à–Ω–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ Zabbix (–æ–±—ã—á–Ω–æ: `/usr/lib/zabbix/externalscripts/`):

```bash
wget https://raw.githubusercontent.com/RoganovDA/zabbix_rtsp/refs/heads/main/check_rtsp.py
sudo cp check_rtsp.py /usr/lib/zabbix/externalscripts/
sudo chmod +x /usr/lib/zabbix/externalscripts/check_rtsp.py
sudo chown zabbix:zabbix /usr/lib/zabbix/externalscripts/check_rtsp.py
sudo chown zabbix:zabbix /var/log/check_rtsp.log
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Zabbix –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ/–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

---

## üîç –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –≤—Ä—É—á–Ω—É—é, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ç–æ–∫:

```bash
check_rtsp.py <login> <password> <ip> <port> <path>
```

–ü—Ä–∏–º–µ—Ä:
```bash
/usr/lib/zabbix/externalscripts/check_rtsp.py admin secret 192.168.1.100 554 live/maim
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
```json
{
  "status": "ok",
  "frames_read": 45,
  "avg_frame_size_kb": 82.7,
  "width": 1920,
  "height": 1080,
  "avg_brightness": 122.3,
  "frame_change_level": 4.8,
  "real_fps": 15.0,
  "note": ""
}
```

---

## ‚öôÔ∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Zabbix

1. –¢–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–∞–Ω–Ω—ã—Ö: **External check**
2. –ö–ª—é—á:  
   ```
   check_rtsp.py[admin,secret,192.168.1.100,554,live/stream1]
   ```
3. –¢–∏–ø –∑–Ω–∞—á–µ–Ω–∏–π: **–¢–µ–∫—Å—Ç**
4. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —à–∞–±–ª–æ–Ω, –µ—Å–ª–∏ –æ–Ω —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å

> –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `jq` –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Zabbix Proxy –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.

---

## üìù –õ–æ–≥-—Ñ–∞–π–ª

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è –≤:
```
/var/log/check_rtsp.log
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑–º–µ—Ä –ª–æ–≥–∞ –∏ **–æ—á–∏—â–∞–µ—Ç –µ–≥–æ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 50 –ú–ë**.

---

## üõ† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `logrotate`, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∞—Ä—Ö–∏–≤—ã –ª–æ–≥–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –ø–∞—Ä–µ —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ —Ç–∏–ø–∞ Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –≤ Zabbix –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–µ–π `status`, `real_fps`, `frame_change_level`

---

## üß© –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

–ò–¥–µ–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π:
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–¥—Ä–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á—Ç–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–∞–º–µ—Ä –∏–∑ —Ñ–∞–π–ª–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä –≤ –ø–æ–¥—Å–µ—Ç–∏ (–ø–æ ONVIF / SSDP)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º / –º–∞—Å—Å–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License ‚Äî —Å–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∞–≤—Ç–æ—Ä—Å—Ç–≤–∞.

---

## üôå –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

–°–æ–∑–¥–∞–Ω –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ IP-–∫–∞–º–µ—Ä –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏.  
–ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –≤–∞–º –ø–æ–º–æ–≥ ‚Äî –∑–≤–µ–∑–¥–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é –Ω–∞ GitHub –±—É–¥–µ—Ç –ª—É—á—à–µ–π –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é ‚≠êÔ∏è
